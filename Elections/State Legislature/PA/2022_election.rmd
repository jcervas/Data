

```{r, variable names}
data_names <- c(
     "year",
     "type",
     "county",
     "prec",
     "office_code",
     "district",
     "party_code",
     "ballot_pos",
     "office",
     "party",
     "cand_num",
     "last",
     "first",
     "middle",
     "suffix",
     "vote",
     "yes",
     "no",
     "cong_dist",
     "sen_dist",
     "house_dist",
     "muni_type",
     "muni_name",
     "muni_breakdown_code_1",
     "muni_breakdown_name_1",
     "muni_breakdown_code_2",
     "muni_breakdown_name_2",
     "bicounty_code",
     "mcd",
     "fips",
     "vtd",
     "ballot_question",
     "record_type",
     "prev_prec_code",
     "prev_cong_dist",
     "prev_sen_dist",
     "prev_house_dist"
)
```

```{r}
g22 <- read.csv("https://www.dos.pa.gov/VotingElections/BEST/stats/Documents/ElectionReturns_2022_General_PrecinctReturns.txt", header=FALSE, stringsAsFactors=FALSE)
     names(g22) <- data_names
```


```{r}

DEM <- subset(g22, (party=="DEM"))
GOP <- subset(g22, (party=="REP"))
OTH <- subset(g22, (!party %in% c("DEM","REP")))

USS <- subset(g22, (office=="USS"))
GOV <- subset(g22, (office=="GOV"))
USC <- subset(g22, (office=="USC"))
STH <- subset(g22, (office=="STH"))
STS <- subset(g22, (office=="STS"))
```



```{r, GOV}


total_votes_by_party <- function(df) {
  offices <- unique(df$office)  # Get unique office names
  
  result <- data.frame()  # Create an empty data frame to store the results
  
  for (office in offices) {
    # Aggregate the data for the current office
    house <- aggregate(vote ~ house_dist + cand_num + last, data = subset(df, office == office), sum)
    prev_house <- aggregate(vote ~ prev_house_dist + cand_num + last, data = subset(df, office == office), sum)
    sen <- aggregate(vote ~ sen_dist + cand_num + last, data = subset(df, office == office), sum)
    prev_sen <- aggregate(vote ~ prev_sen_dist + cand_num + last, data = subset(df, office == office), sum)
    
    # Convert the aggregates to wide format
    wide_house <- reshape(house, idvar = c("house_dist", "last"), timevar = "cand_num", direction = "wide")
    wide_prev_house <- reshape(prev_house, idvar = c("prev_house_dist", "last"), timevar = "cand_num", direction = "wide")
    wide_sen <- reshape(sen, idvar = c("sen_dist", "last"), timevar = "cand_num", direction = "wide")
    wide_prev_sen <- reshape(prev_sen, idvar = c("prev_sen_dist", "last"), timevar = "cand_num", direction = "wide")
    
    # Merge the wide data frames by last name
    office_result <- merge(wide_house, wide_prev_house, by = "last", all = TRUE)
    office_result <- merge(office_result, wide_sen, by = "last", all = TRUE)
    office_result <- merge(office_result, wide_prev_sen, by = "last", all = TRUE)
    
    # Add a column for the current office and rearrange the columns
    office_result$office <- office
    office_result <- office_result[, c("office", "last", 
                                        paste0("house_", names(wide_house)[-c(1:2)]),
                                        paste0("prev_house_", names(wide_prev_house)[-c(1:2)]),
                                        paste0("sen_", names(wide_sen)[-c(1:2)]),
                                        paste0("prev_sen_", names(wide_prev_sen)[-c(1:2)]))]
    
    # Merge the results for the current office into the overall result
    if (nrow(result) == 0) {
      result <- office_result  # First office
    } else {
      result <- rbind(result, office_result)  # Subsequent offices
    }
  }
  
  return(result)
}



```


```{r, USS}
fetterman <- subset(g22, (last=="FETTERMAN"))
oz <- subset(g22, (last=="OZ"))

fetterman_house <- aggregate(list(dem=fetterman$vote), list(house_dist=fetterman$house_dist), FUN=sum)
oz_house <- aggregate(list(gop=oz$vote), list(house_dist=oz$house_dist), FUN=sum)

fetterman_sen <- aggregate(list(dem=fetterman$vote), list(sen_dist=fetterman$sen_dist), FUN=sum)
oz_sen <- aggregate(list(gop=oz$vote), list(sen_dist=oz$sen_dist), FUN=sum)

house_by_USS <- cbind(fetterman_house, oz_house)
sen_by_USS <- cbind(fetterman_sen, oz_sen)
```



```{r}
house_by_USS$DEM <- house_by_USS$dem/(house_by_USS$dem + house_by_USS$gop)
sen_by_USS$DEM <- sen_by_USS$dem/(sen_by_USS$dem + sen_by_USS$gop)

## seats by party
table(1 * (house_by_USS$DEM > 0.5))
prop.table(table(1 * (house_by_USS$DEM > 0.5)))
mean(house_by_USS$DEM)

table(1 * (sen_by_USS$DEM > 0.5))
prop.table(table(1 * (sen_by_USS$DEM > 0.5)))
mean(sen_by_USS$DEM)
```

```{r}

```



```{r}
range_sim <- seq(-0.1,1,0.01)
full_sims <- rep(house_by_USS$DEM, length(range_sim))

1 * (full_sims > 0.5)

```

